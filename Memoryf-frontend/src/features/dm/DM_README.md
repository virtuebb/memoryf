# ğŸ’¬ DM (ë‹¤ì´ë ‰íŠ¸ ë©”ì‹œì§€) ê¸°ëŠ¥ ê°€ì´ë“œ

## ğŸ“ í´ë” êµ¬ì¡°

```
dm/
â”œâ”€â”€ components/          # UI ì»´í¬ë„ŒíŠ¸ë“¤
â”‚   â”œâ”€â”€ ChatList.jsx     # ì±„íŒ…ë°© ëª©ë¡
â”‚   â”œâ”€â”€ ChatRoom.jsx     # ê°œë³„ ì±„íŒ…ë°© í™”ë©´
â”‚   â”œâ”€â”€ Chat.jsx         # WebSocket í…ŒìŠ¤íŠ¸ìš© (ë³„ë„ README ì°¸ê³ )
â”‚   â”œâ”€â”€ FloatingDm.jsx   # í”Œë¡œíŒ… DM ë²„íŠ¼ (PIP ìŠ¤íƒ€ì¼)
â”‚   â”œâ”€â”€ ThemeSelector.jsx # í…Œë§ˆ ì„ íƒê¸°
â”‚   â””â”€â”€ UserSearchModal.jsx # ì‚¬ìš©ì ê²€ìƒ‰ ëª¨ë‹¬
â”‚
â”œâ”€â”€ context/             # ì „ì—­ ìƒíƒœ ê´€ë¦¬
â”‚   â””â”€â”€ DmContext.jsx    # ì±„íŒ… ë°ì´í„° ê³µìœ  Context
â”‚
â”œâ”€â”€ css/                 # ìŠ¤íƒ€ì¼ íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ ChatList.css
â”‚   â”œâ”€â”€ ChatRoom.css
â”‚   â”œâ”€â”€ Chat.css
â”‚   â”œâ”€â”€ FloatingDm.css
â”‚   â”œâ”€â”€ ThemeSelector.css
â”‚   â””â”€â”€ UserSearchModal.css
â”‚
â”œâ”€â”€ data/                # ë”ë¯¸ ë°ì´í„°
â”‚   â””â”€â”€ chats.js         # í…ŒìŠ¤íŠ¸ìš© ì±„íŒ…ë°©/ë©”ì‹œì§€ ë°ì´í„°
â”‚
â”œâ”€â”€ pages/               # ë¼ìš°íŠ¸ í˜ì´ì§€
â”‚   â””â”€â”€ DmRoutes.jsx     # /messages ë¼ìš°íŠ¸ ì²˜ë¦¬
â”‚
â””â”€â”€ themes.js            # í…Œë§ˆ ì„¤ì • (ì‚¬ìš© ì•ˆ í•¨, ThemeContext ì‚¬ìš©)
```

---

## ğŸ”„ ì‘ë™ ì›ë¦¬

### 1. ë‘ ê°€ì§€ DM ì ‘ê·¼ ë°©ì‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        App.jsx                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    DmProvider                            â”‚ â”‚
â”‚  â”‚         (ì±„íŒ… ë°ì´í„°ë¥¼ ì „ì—­ì—ì„œ ê´€ë¦¬)                      â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚   â”‚  DmRoutes   â”‚              â”‚   FloatingDm    â”‚       â”‚ â”‚
â”‚  â”‚   â”‚ /messages/* â”‚              â”‚ (ìš°ì¸¡ í•˜ë‹¨ ë²„íŠ¼) â”‚       â”‚ â”‚
â”‚  â”‚   â”‚             â”‚    ë™ê¸°í™”    â”‚                 â”‚       â”‚ â”‚
â”‚  â”‚   â”‚ â† useDm() â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€ useDm() â†’    â”‚       â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ë°©ì‹ | ì ‘ê·¼ ê²½ë¡œ | ì„¤ëª… |
|------|----------|------|
| **DmRoutes** | `/messages` | ì „ì²´ í™”ë©´ DM í˜ì´ì§€ |
| **FloatingDm** | ëª¨ë“  í˜ì´ì§€ | ìš°ì¸¡ í•˜ë‹¨ í”Œë¡œíŒ… ë²„íŠ¼ (PIP) |

**ë‘ ë°©ì‹ ëª¨ë‘ `DmContext`ë¥¼ í†µí•´ ê°™ì€ ë°ì´í„°ë¥¼ ê³µìœ **í•˜ë¯€ë¡œ, í•œìª½ì—ì„œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ë‹¤ë¥¸ ìª½ì—ì„œë„ ì‹¤ì‹œê°„ ë°˜ì˜ë©ë‹ˆë‹¤.

---

### 2. DmContext (ì „ì—­ ìƒíƒœ ê´€ë¦¬)

```jsx
// DmContextê°€ ê´€ë¦¬í•˜ëŠ” ê²ƒë“¤
{
  chatRooms,        // í™œì„±í™”ëœ ì±„íŒ…ë°© ëª©ë¡
  pendingChats,     // ëŒ€ê¸° ì¤‘ì¸ ì±„íŒ…ë°© (ì•„ì§ ë©”ì‹œì§€ ì•ˆ ë³´ë‚¸ ë°©)
  allChats,         // chatRooms + pendingChats
  totalUnread,      // ì´ ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜
  isSearchModalOpen, // ê²€ìƒ‰ ëª¨ë‹¬ ìƒíƒœ
  
  // í•¨ìˆ˜ë“¤
  handleMarkAsRead,  // ì½ìŒ ì²˜ë¦¬
  handleAddUser,     // ìƒˆ ì±„íŒ… ì‹œì‘
  handleSendMessage, // ë©”ì‹œì§€ ì „ì†¡
  openSearchModal,   // ê²€ìƒ‰ ëª¨ë‹¬ ì—´ê¸°
  closeSearchModal,  // ê²€ìƒ‰ ëª¨ë‹¬ ë‹«ê¸°
}
```

### 3. ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì•¡ì…˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component      â”‚  (ChatRoom, ChatList, FloatingDm ë“±)
â”‚  useDm() í›… ì‚¬ìš©  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DmContext     â”‚  (ì „ì—­ ìƒíƒœ)
â”‚  - chatRooms    â”‚
â”‚  - pendingChats â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ (ìƒíƒœ ë³€ê²½ ì‹œ ëª¨ë“  êµ¬ë… ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ëª¨ë“  DM ê´€ë ¨      â”‚
â”‚ ì»´í¬ë„ŒíŠ¸ ì—…ë°ì´íŠ¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì„¤ëª…

### ChatList.jsx
ì±„íŒ…ë°© ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸

```jsx
<ChatList
  chats={allChats}           // ì±„íŒ…ë°© ë°°ì—´
  onSelectChat={fn}          // ì±„íŒ…ë°© í´ë¦­ ì‹œ
  onOpenSearch={fn}          // + ë²„íŠ¼ í´ë¦­ ì‹œ
  themeClass="light|dark"    // í…Œë§ˆ
/>
```

### ChatRoom.jsx
ê°œë³„ ì±„íŒ…ë°© í™”ë©´

```jsx
<ChatRoom
  chat={selectedChat}        // ì„ íƒëœ ì±„íŒ…ë°© ê°ì²´
  onBack={fn}                // ë’¤ë¡œê°€ê¸°
  onSendMessage={fn}         // ë©”ì‹œì§€ ì „ì†¡
  onMarkAsRead={fn}          // ì½ìŒ ì²˜ë¦¬
  themeClass="light|dark"    // í…Œë§ˆ
  hideHeader={false}         // FloatingDmì—ì„œ true
/>
```

### FloatingDm.jsx
í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì— ë– ìˆëŠ” DM ë²„íŠ¼/ì°½

- í´ë¦­í•˜ë©´ ì±„íŒ…ì°½ ì—´ë¦¼
- ë“œë˜ê·¸ë¡œ ìœ„ì¹˜ ì´ë™ ê°€ëŠ¥
- ìµœì†Œí™”/ë‹«ê¸° ë²„íŠ¼
- ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ë°°ì§€ í‘œì‹œ

---

## ğŸ’¾ ë°ì´í„° êµ¬ì¡°

### ì±„íŒ…ë°© (Chat Room)
```javascript
{
  id: 1,                    // ê³ ìœ  ID
  userId: 'user123',        // ìƒëŒ€ë°© ID
  userName: 'ê¹€ì² ìˆ˜',        // ìƒëŒ€ë°© ì´ë¦„
  lastMessage: 'ì•ˆë…•!',      // ë§ˆì§€ë§‰ ë©”ì‹œì§€ ë¯¸ë¦¬ë³´ê¸°
  time: 'ì˜¤í›„ 4:33',         // ë§ˆì§€ë§‰ ë©”ì‹œì§€ ì‹œê°„
  unread: 2,                // ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜
  avatar: 'ğŸ‘¤',             // í”„ë¡œí•„ (ì´ëª¨ì§€ or ì´ë¯¸ì§€ URL)
  messages: [...],          // ë©”ì‹œì§€ ë°°ì—´
  isPending: false          // ëŒ€ê¸° ì¤‘ ì—¬ë¶€
}
```

### ë©”ì‹œì§€ (Message)
```javascript
{
  id: 12345,                // ê³ ìœ  ID
  text: 'ì•ˆë…•í•˜ì„¸ìš”!',       // ë©”ì‹œì§€ ë‚´ìš©
  time: 'ì˜¤í›„ 4:30',         // ì „ì†¡ ì‹œê°„
  isMine: true,             // ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ì¸ì§€
  isRead: false             // ìƒëŒ€ë°©ì´ ì½ì—ˆëŠ”ì§€
}
```

---

## ğŸ”Œ ë°±ì—”ë“œ ì—°ë™ (TODO)

í˜„ì¬ëŠ” ë”ë¯¸ ë°ì´í„°(`data/chats.js`)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
ì‹¤ì œ ë°±ì—”ë“œ ì—°ë™ ì‹œ í•„ìš”í•œ API:

| API | ì„¤ëª… |
|-----|------|
| `GET /api/dm/rooms` | ë‚´ ì±„íŒ…ë°© ëª©ë¡ |
| `POST /api/dm/rooms` | ìƒˆ ì±„íŒ…ë°© ìƒì„± |
| `GET /api/dm/rooms/{id}/messages` | ë©”ì‹œì§€ ëª©ë¡ |
| `POST /api/dm/rooms/{id}/messages` | ë©”ì‹œì§€ ì „ì†¡ |
| `PUT /api/dm/rooms/{id}/read` | ì½ìŒ ì²˜ë¦¬ |

**ì‹¤ì‹œê°„ ë©”ì‹œì§€ëŠ” WebSocket ì‚¬ìš©** â†’ `Chat.jsx` README ì°¸ê³ 

---

## ğŸ¨ í…Œë§ˆ ì§€ì›

`ThemeContext`ì™€ ì—°ë™ë˜ì–´ 4ê°€ì§€ í…Œë§ˆ ì§€ì›:

| í…Œë§ˆ | ì„¤ëª… |
|------|------|
| Rose | ë¶€ë“œëŸ¬ìš´ í•‘í¬ |
| Cream | ë”°ëœ»í•œ í¬ë¦¼ìƒ‰ |
| Forest | ìƒì¾Œí•œ ì´ˆë¡ |
| Night | ë‹¤í¬ ëª¨ë“œ |

---

## ğŸ“± ì‚¬ìš© ì˜ˆì‹œ

```jsx
// App.jsx
import { DmProvider } from './features/dm/context/DmContext';
import FloatingDm from './features/dm/components/FloatingDm';
import DmRoutes from './features/dm/pages/DmRoutes';

function App() {
  return (
    <ThemeProvider>
      <DmProvider>
        {/* ë¼ìš°íŠ¸ì—ì„œ DM í˜ì´ì§€ */}
        <Route path="/messages/*" element={<DmRoutes />} />
        
        {/* í”Œë¡œíŒ… DM ë²„íŠ¼ (ëª¨ë“  í˜ì´ì§€ì—ì„œ ë³´ì„) */}
        <FloatingDm />
      </DmProvider>
    </ThemeProvider>
  );
}
```


# DM ê´€ë ¨ ê¸°ëŠ¥ì— ì›¹ì†Œì¼“ ì—°ê²°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User1 (ë¸Œë¼ìš°ì € íƒ­ 1)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  ChatRoom   â”‚ â†’ handleSendMessage()                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                                  â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  DmContext (WebSocket)                           â”‚        â”‚
â”‚  â”‚  stompClient.publish({                          â”‚        â”‚
â”‚  â”‚    destination: '/pub/chat/private',            â”‚        â”‚
â”‚  â”‚    body: { roomId: 'user2', sender: 'user1' }   â”‚        â”‚
â”‚  â”‚  })                                             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spring Boot Backend (/pub/chat/private)                    â”‚
â”‚  â†’ convertAndSend("/sub/private/user2", message)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User2 (ë¸Œë¼ìš°ì € íƒ­ 2)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  DmContext (WebSocket)                           â”‚        â”‚
â”‚  â”‚  subscribe('/sub/private/user2') â†’ ë©”ì‹œì§€ ìˆ˜ì‹    â”‚        â”‚
â”‚  â”‚  handleReceiveMessage() â†’ ì±„íŒ…ë°©ì— ë©”ì‹œì§€ ì¶”ê°€    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                          â”‚                                  â”‚
â”‚                          â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  ChatRoom   â”‚ â† ìë™ UI ì—…ë°ì´íŠ¸                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜