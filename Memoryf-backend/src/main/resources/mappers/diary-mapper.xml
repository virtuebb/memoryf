<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="DiaryMapper">

    <!-- âœ… ì»¬ëŸ¼ â†” í•„ë“œ ì •í™• ë§¤í•‘ -->
    <resultMap id="DiaryMap" type="Diary">
        <id property="diaryNo" column="DIARY_NO"/>
        <result property="title" column="TITLE"/>
        <result property="content" column="CONTENT"/>
        <result property="memberNo" column="MEMBER_NO"/>
        <result property="createdAt" column="CREATED_AT"/>
        <result property="isDeleted" column="IS_DELETED"/>
    </resultMap>

    <!-- âœï¸ ìž‘ì„± -->
    <insert id="insertDiary" parameterType="Diary">
        INSERT INTO TB_DIARY (
            DIARY_NO,
            TITLE,
            CONTENT,
            CREATED_AT,
            IS_DELETED,
            MEMBER_NO
        ) VALUES (
            SEQ_DIARY_NO.NEXTVAL,
            #{title},
            #{content},
            SYSDATE,
            'N',
            #{memberNo}
        )
    </insert>

    <!-- ðŸ“„ ëª©ë¡ (íŽ˜ì´ì§•) -->
    <select id="selectDiaryList" parameterType="map" resultMap="DiaryMap">
        SELECT *
        FROM (
            SELECT A.*, ROWNUM RNUM
            FROM (
                SELECT *
                FROM TB_DIARY
                WHERE
                    MEMBER_NO = #{memberNo}
                    AND IS_DELETED = 'N'
                ORDER BY CREATED_AT DESC
            ) A
            WHERE ROWNUM <![CDATA[<=]]> #{end}
        )
        WHERE RNUM <![CDATA[>=]]> #{start}
    </select>

    <!-- ðŸ—‘ ì‚­ì œ -->
    <update id="deleteDiary" parameterType="int">
        UPDATE TB_DIARY
        SET IS_DELETED = 'Y'
        WHERE DIARY_NO = #{diaryNo}
    </update>

    <!-- ðŸ”¢ ì´ ê°œìˆ˜ -->
    <select id="selectDiaryCount" parameterType="int" resultType="int">
        SELECT COUNT(*)
        FROM TB_DIARY
        WHERE
            MEMBER_NO = #{memberNo}
            AND IS_DEL = 'N'
    </select>
    
    <!-- ë‹¤ì´ì–´ë¦¬ ìˆ˜ì • -->
    <update id="updateDiary" parameterType="Diary">
    	UPDATE TB_DIARY
		SET
		  CONTENT = #{content}
		WHERE DIARY_NO = #{diaryNo}
		AND MEMBER_NO = #{memberNo}
    </update>
    

</mapper>
